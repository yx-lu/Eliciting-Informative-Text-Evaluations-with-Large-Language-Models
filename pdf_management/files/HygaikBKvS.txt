Title:
```
None
```
Abstract:
```
We investigate the combination of actor-critic reinforcement learning algorithms with uniform large-scale experience replay and propose solutions for two chal- lenges: (a) efficient actor-critic learning with experience replay (b) stability of off-policy learning where agents learn from other agents behaviour. We employ those insights to accelerate hyper-parameter sweeps in which all participating agents run concurrently and share their experience via a common replay module. To this end we analyze the bias-variance tradeoffs in V-trace, a form of importance sampling for actor-critic methods. Based on our analysis, we then argue for mixing experience sampled from replay with on-policy experience, and propose a new trust region scheme that scales effectively to data distributions where V-trace becomes unstable. We provide extensive empirical validation of the proposed solution. We further show the benefits of this setup by demonstrating state-of-the-art data efficiency on Atari among agents trained up until 200M environment frames.
```

Figures/Tables Captions:
```
Figure 1: Sharing experience between agents leads to more efficient hyper-parameter sweeps on 57 Atari games. Prior art results are presented as horizontal lines (with scores cited from Gruslys et al. (2018), Hessel et al. (2017) and Mnih et al. (2013)). Note that the only previous agent "R2D2" that achieved a score beyond 400% required more than 3,000 million environment steps (see Kapturowski et al. (2019), page 14, Figure 9). We present the pointwise best agent from hyper-parameter sweeps with and without experience replay (shared and not shared). Each sweep contains 9 agents with different learning rate and entropy cost combinations. Replay experiment were repeated twice and ran for 50M steps. To report scores at 200M we ran the baseline and one shared experience replay agent for 200M steps.
Figure 2: Left: Learning entirely off-policy from experience replay fails, while combining on-policy data with experience replay leads to improved data efficiency: We present sweeps on DMLab-30 with experience replays of 10M capacity. A ratio of 87.5% implies that there are 7 replayed transitions in the batch for each online transition. Furthermore we consider an agent identical to "LASER 87.5% replay" which however draws all samples from replay. Its batch thus does not contain any online data and we observe a significant performance decrease (see Proposition 2 and 3). The shading represents the point-wise best and worst replica among 3 repetitions. The solid line is the mean. Right: The effect of capacity in experience replay with 87.5% replay data per batch on sweeps on DMLab-30. Data-efficiency improves with larger capacity.
Figure 3: Left: Naively sharing experience between distinct agents in a hyper-parameter sweep fails (green) and is worse than the no-replay baseline (blue). The proposed trust region estimator mitigates the issue (red). Right: Combining population based training with trust region estimation improves performance further. All replay experiments use a capacity of 10 million observations and 87.5% replay data per batch.
Table 1: Comparison of state-of-the-art agents on 57 Atari games trained up until 200M environment steps (per game) and DMLab-30 trained until 10B steps (multi-task; all games combined). The first two rows are quoted from Xu et al. (2018) and Hessel et al. (2019), the third is our implementation of a pixel control agent from Hessel et al. (2019) and the last two rows are our proposed LASER (LArge Scale Experience Replay) agent. All agents use hyper-parameter sweeps expect for the marked.
```

Main Content:
```

Section Title: INTRODUCTION
  INTRODUCTION Value-based and actor-critic policy gradient methods are the two leading techniques of constructing general and scalable reinforcement learning agents ( Sutton et al., 2018 ). Both have been combined with non-linear function approximation ( Tesauro, 1995 ;  Williams, 1992 ), and have achieved remark- able successes on multiple challenging domains; yet, these algorithms still require large amounts of data to determine good policies for any new environment. To improve data efficiency, experience replay agents store experience in a memory buffer (replay) ( Lin, 1992 ), and reuse it multiple times to perform reinforcement learning updates ( Riedmiller, 2005 ). Experience replay allows to generalize prioritized sweeping ( Moore & Atkeson, 1993 ) to the non-tabular setting ( Schaul et al., 2015 ), and can also be used to simplify exploration by including expert (e.g., human) trajectories ( Hester et al., 2017 ). Overall, experience replay can be very effective at reducing the number of interactions with the environment otherwise required by deep reinforcement learning algorithms ( Schaul et al., 2015 ). Replay is often combined with the value-based Q-learning ( Mnih et al., 2015 ), as it is an off-policy algorithm by construction, and can perform well even if the sampling distribution from replay is not aligned with the latest agent's policy. Combining experience replay with actor-critic algorithms can be harder due to their on-policy nature. Hence, most established actor-critic algorithms with replay such as ( Wang et al., 2017 ;  Gruslys et al., 2018 ;  Haarnoja et al., 2018 ) employ and maintain Q-functions to learn from the replayed off-policy experience. In this paper, we demonstrate that off-policy actor-critic learning with experience replay can be achieved without surrogate Q-function approximators using V-trace by employing the following approaches: a) off-policy replay experience needs to be mixed with a proportion of on-policy experience. We show experimentally ( Figure 2 ) and theoretically that the V-trace policy gradient is otherwise not guaranteed to converge to a locally optimal solution. b) a trust region scheme ( Conn et al., 2000 ;  Schulman et al., 2015 ;  2017 ) can mitigate bias and enable efficient learning in a strongly off-policy regime, where distinct agents share experience through a commonly shared replay module. Sharing experience permits the agents to benefit from parallel exploration ( Kretchmar, 2002 ) ( Figures 1  and 3). Our paper is structured as follows: In Section 2 we revisit pure importance sampling for actor-critic agents ( Degris et al., 2012 ) and V-trace, which is notable for allowing to trade off bias and variance Under review as a conference paper at ICLR 2020 in its estimates. We recall that variance reduction is necessary (Figure 4 left) but is biased in V-trace. We derive proposition 2 stating that off-policy V-trace is not guaranteed to converge to a locally optimal solution - not even in an idealized scenario when provided with the optimal value function. Through theoretical analysis (Section 3) and experimental validation ( Figure 2 ) we determine that mixing on-policy experience into experience replay alleviates the problem. Furthermore we propose a trust region scheme ( Conn et al., 2000 ;  Schulman et al., 2015 ;  2017 ) in Section 4 that enables efficient learning even in a strongly off-policy regime, where distinct agents share the experience replay module and learn from each others experience. We define the trust region in policy space and prove that the resulting estimator is correct (i.e. estimates an improved return). As a result, we present state-of-the-art data efficiency in Section 5 in terms of median human normalized performance across 57 Atari games ( Bellemare et al., 2013 ), as well as improved learning efficiency on DMLab30 ( Beattie et al., 2016 ) ( Table 1 ).

Section Title: THE ISSUE WITH IMPORTANCE SAMPLING: BIAS AND VARIANCE IN V-TRACE
  THE ISSUE WITH IMPORTANCE SAMPLING: BIAS AND VARIANCE IN V-TRACE V-trace importance sampling is a popular off-policy correction for actor-critic agents ( Espeholt et al., 2018 ). In this section we revisit how V-trace controls the (potentially infinite) variance that arises from naive importance sampling. We note that this comes at the cost of a biased estimate (see Proposition 1) and creates a failure mode (see Proposition 2) which makes the policy gradient biased. We discuss our solutions for said issues in Section 4.

Section Title: REINFORCEMENT LEARNING
  REINFORCEMENT LEARNING We follow the notation of  Sutton et al. (2018)  where an agent interacts with its environment, to collect rewards. On each discrete time-step t, the agent selects an action a t ; it receives in return a reward r t and an observation o t+1 , encoding a partial view of the environment's state s t+1 . In the fully Under review as a conference paper at ICLR 2020 observable case, the RL problem is formalized as a Markov Decision Process ( Bellman, 1957 ): a tuple (S, A, p, γ), where S, A denotes finite sets of states and actions, p models rewards and state transitions (so that r t , s t+1 ∼ p(s t , a t )), and γ is a fixed discount factor. A policy is a mapping π(a|s) from states to action probabilities. The agent seeks an optimal policy π * that maximizes the value, defined as the expectation of the cumulative discounted returns G t = ∞ k=0 γ k r t+k . Off-policy learning is the problem of finding, or evaluating, a policy π from data generated by a different policy µ. This arises in several settings. Experience replay ( Lin, 1992 ) mixes data from multiple iterations of policy improvement. In large-scale RL, decoupling acting from learning ( Nair et al., 2015 ;  Horgan et al., 2018 ;  Espeholt et al., 2018 ) causes the experience to lag behind the latest agent policy. Finally, it is often useful to learn multiple general value functions ( Sutton et al., 2011 ;  Mankowitz et al., 2018 ;  Lample & Chaplot, 2016 ;  Mirowski et al., 2017 ;  Jaderberg et al., 2017b ) or options ( Sutton et al., 1999 ;  Bacon et al., 2017 ) from a single stream of experience.

Section Title: NAIVE IMPORTANCE SAMPLING
  NAIVE IMPORTANCE SAMPLING On-policy n-step bootstraps give more accurate value estimates in expectation with larger n ( Sutton et al., 2018 ). They are used in many reinforcement learning agents ( Mnih et al., 2016 ;  Schulman et al., 2017 ;  Hessel et al., 2017 ). Unfortunately n must be chosen suitably as the estimates variance increases with n too. It is desirable to obtain benefits akin to n-step returns in the off-policy case. To this end multi-step importance sampling ( Kahn, 1955 ) can be used. This however adds another source of (potentially infinite ( Sutton et al., 2018 )) variance to the estimate. Importance sampling can estimate the expected return V π from trajectories sampled from µ = π, as long as µ is non-zero whereever π is. We employ a previously estimated value function V as a bootstrap to estimate expected returns. Following  Degris et al. (2012) , a multi-step formulation of the expected return is V π (s t ) = E µ V (s t ) + K−1 k=0 γ k k i=0 π t+i µ t+i δ t+k V (1) where E µ denotes the expectation under policy µ up to an episode termination, δ t V = r t + γV (s t+1 ) − V (s t ) is the temporal difference error in consecutive states s t+1 , s t , and π t = π t (a t |s t ). Importance sampling estimates can have high variance. Tree Backup ( Precup et al., 2000 ), and Q(λ) ( Sutton et al., 2014 ) address this, but reduce the number of steps before bootstrapping even when this is undesirable (as in the on-policy case). RETRACE ( Munos et al., 2016 ) makes use of full returns in the on-policy case, but it introduces a zero-mean random variable at each step, adding variance to empirical estimates in both on- and off-policy cases.

Section Title: BIAS-VARIANCE ANALYSIS & FAILURE MODE OF V-TRACE IMPORTANCE SAMPLING
  BIAS-VARIANCE ANALYSIS & FAILURE MODE OF V-TRACE IMPORTANCE SAMPLING V-trace ( Espeholt et al., 2018 ) reduces the variance of importance sampling by trading off variance for a biased estimate of the return - resulting in a failure mode (see Proposition 2). It uses clipped impor- tance sampling ratios to approximate V π by Vπ(s t ) = V (s t )+ K−1 k=0 γ k k−1 i=0 c i ρ t δ t+k V where V is a learned state value estimate used to bootstrap, and ρ t = min [π t /µ t ,ρ], c t = min [π t /µ t ,c] are the clipped importance ratios. Note that, differently from RETRACE, V-trace fully recovers the Monte Carlo return when on policy. It similarly reweights the policy gradient as: Note that ∇Vπ(s t ) recovers the naively importance sampled policy gradient forρ → ∞. In the literature, it is common to subtract a baseline from the action-value estimate r t + γVπ(s t+1 ) to reduce variance ( Williams, 1992 ), omitted here for simplicity. The constantsρ ≥c ≥ 1 (typically chosenρ =c = 1) define the level of clipping, and improve stability by ensuring a bounded variance. For any givenρ, the bias introduced by V-trace in the value and policy gradient estimates increases with the difference between π and µ. We analyze this in the following propositions. Proposition 1. The V-trace value estimate Vπ is biased: It does not match the expected return of π but the return of a related implied policyπ defined by equation 3 that depends on the behaviour Under review as a conference paper at ICLR 2020 policy µ:π Proof. See  Espeholt et al. (2018) . Note that the biased policyπ µ can be very different from π. Hence the V-trace value estimate Vπ may be very different from V π as well. As an illustrative example, consider two policies over a set of two actions, e.g. "left" and "right" represented as a tuple of probabilities. Let us investigate µ = (φ, 1 − φ) and π = (1 − φ, φ) defined for any suitably small φ ≤ 1. Observe that π and µ share no trajectories (state-action sequences) in the limit as φ → 0 and they get more focused on one action. A practical example of this could be two policies, one almost always taking a left turn and one always taking the right. Given sufficient data of either policy it is possible to estimate the value of the other e.g. with naive importance sampling. However observe that V-trace withρ = 1 will always estimate a biased value - even given infinite data. Observe that min [µ(a|x), π(a|x)] = min [φ, 1 − φ] for both actions. Thusπ µ is uniform rather than resembling π the policy. The V-trace estimate Vπ would thus compute the average value of "left" and "right" - poorly representing the true V π . Proposition 2. The V-trace policy gradient is biased: given the the optimal value function V * the V-trace policy gradient does not converge to a locally optimal π * for all off-policy behaviour distributions µ. Proof. See Appendix C.

Section Title: MIXING ON- AND OFF-POLICY EXPERIENCE
  MIXING ON- AND OFF-POLICY EXPERIENCE In Proposition 2 we presented a failure mode in V-trace where the variance reduction biases the value estimate and policy gradient. V-trace computes biased Q-estimates Q ω = Q resulting in a wrong local policy gradient: ∇E π(a|s) [Q ω (s, a)] = ∇E π(a|s) [Q(s, a)]. In equation 10 we show The question of how biased the resulting policy will be depends on whether the distortion changes the argmax of the Q-function. Little distortions that do not change the argmax will result in the same local fixpoint of the policy improvement. The policy will continue to select the optimal action and it will not be biased at this state. The policy will however be biased if the Q-function is distorted too much. For example consider a ω(s, a) that swaps the argmax for the 2nd largest value, the regret will then be the difference between the maximum and the 2nd largest value. Intuitively speaking the more distorted the Q ω , the larger will be the regret compared to the optimal policy. More precisely, the regret of learning a policy that maximizes the distorted Q ω at state s is: R(s) = Q(s, a * ) − Q(s, a actual ) = max b Q(s, b) − Q(s, a actual ) where a * = argmax b (Q, b) is the optimal action according to the real Q and a actual = argmax[Q ω (s, a)] = argmax[Q(s, a)ω(s, a)], is the optimal action according to the distorted Q ω . For generality, we denote A * as the set of best actions - covering the case with multiple with identical optimal Q-values. Proposition 3 provides a mitigation: Clearly the V-trace policy gradient will converge to the same solution as the true on-policy gradient if the argmax of the Q-function is preserved at all states in a tabular setting. We show that this can be achieved by mixing a sufficient proportion α of on-policy experience into the computation. We show in equation 13 in the Appendix that choosing α such that will result in a policy that correctly chooses the best action at state s. Note that α 1−α → ∞ as α → 1.

Section Title: Under review as a conference paper at ICLR 2020
  Under review as a conference paper at ICLR 2020 Intuitively: the larger the action value gap of the real Q-function Q(s, a * ) − Q(s, b) the lower the right hand side and the less on-policy data is required. If max b [(Q(s, b)ω(s, b) − Q(s, a * )ω(s, a * )] is negative, then α may be as small as zero and we enabling even pure off-policy learning. Finally note that the right hand side decreases due to d µ (s)/d π (s) if π visits the state s more often than µ. All of those conditions can be computed and checked if an accurate Q-function and state distribution is accessible. How to use imperfect Q-function estimates to adaptively choose such an α remain a question for future research. We provide experimental evidence for these results with function approximators in the 3-dimensional simulated environment DMLab-30 with various α ≥ 1/8 in Section 5.3 and  Figure 2 . We observe that α = 1/8 is sufficient to facilitate stable learning. Furthermore it results in better data-efficiency than pure on-policy learning as it utilizes off-policy replay experience. Mixing online data with replay data has also been argued for by  Zhang & Sutton (2017) , as a heuristic way of reducing the sensitivity of reinforcement learning algorithms to the size of the replay memory. Proposition 3 grounds this in the theoretical properties of V-trace.

Section Title: TRUST REGION SCHEME FOR OFF-POLICY V-TRACE
  TRUST REGION SCHEME FOR OFF-POLICY V-TRACE To mitigate the bias and variance problem of V-trace and importance sampling we propose a trust region scheme that adaptively selects only suitable behaviour distributions when estimating the state-value of π. To this end we introduce a behaviour relevance function that classifies behaviour as relevant. We then define a trust-region estimator that computes expectations (such as expected returns, or the policy gradient) only on relevant transitions. In proposition 4 and 5 we show that this trust region estimator indeed computes new state-value estimates that improve over the current value function. While our analysis and proof is general we propose a suitable behaviour relevance function in section 4.3 that employs the Kullback Leibler divergence between target policy π and implied policyπ µ : KL (π(·|s)||π µ (·|s)). We provide experimental validation in  Figure 3 .

Section Title: BEHAVIOUR RELEVANCE FUNCTIONS
  BEHAVIOUR RELEVANCE FUNCTIONS In off-policy learning we often consider a family of behaviour policies either indexed by training iteration t: M T = {µ t |t < T } for experience replay, or by a different agent k: M K = {µ k |k ∈ K} when training multiple agents. In the classic experience replay case we then sample a time t and locate the transition τ that was generated earlier via µ t . This extends naturally to the multiple agent case where we sample an agent index k and then obtain a transition for such agent or tuples of (k, t). Without loss of generality we simplify this notation and index sampled behaviour policies by a random variable z ∼ Z that represents the selection process. While online reinforcement learning algorithms process transitions τ ∼ π, off-policy algorithms process τ ∼ µ z for z ∼ Z. In this notation, given equation (1) and a bootstrap V , the expectation of importance sampled off-policy returns at state s t is described by: Above E µz|z represents the expectation of sampling from a given µ z . The conditioning on z is a notational reminder that this expectation does not sample z or µ z but experience from µ z . For any Under review as a conference paper at ICLR 2020 sampled z we obtain a µ z and observe that the inner expectation wrt. experience of µ z in equation (4) recovers the expected on-policy return in expectation: This holds provided that µ z is non-zero wherever π is. This fairly standard assumption leads us straight to the core of the problem: it may be that some behaviours µ z are ill-suited for estimating the inner expectation. However, standard importance sampling applied to very off-policy experience divides by small µ resulting in high or even infinite variance. Similarly, V-trace attempts to compute an estimate of the return following π resulting in limited variance at the cost of a biased estimate in turn. The key idea of our proposed solution is to compute the return estimate for π at each state only from a subset of suitable behaviours µ z : as determined by a behaviour relevance function β(π, µ, s) : (M Z , M Z , S) → R and a threshold b. The behaviour relevance function decides if experience from a behaviour is suitable to compute an expected return for π. It can be chosen to control properties of V π mix by restricting the expectation on subsets of Z. In particular it can be used to control the variance of an importance sampled estimator: Observe that the inner expectation E µz G π,µ (s t ) z in equation (4) already matches the expected return V π . Thus we can condition the expectation on arbitrary subsets of Z without changing the expected value of V π mix . This allows us to reject high variance G π,µ without introducing a bias in V π mix . The same technique can be applied to V-trace where we can reject return estimates with high bias.

Section Title: DERIVATION OF TRUST REGION ESTIMATORS
  DERIVATION OF TRUST REGION ESTIMATORS Using a behaviour relevance function β(s) we can define a trust region estimator for regular impor- tance sampling (IS) and V-trace and show their correctness. We define the trust region estimator as the conditional expectation V π trusted (s t ) = E z E µz|z G π,µz,β (s t ) µ z ∈ M β,π (s t ) (6) with λ-returns G, chosen as G IS for importance sampling and G Vtrace for V-trace: Vtrace are a multi-step return estimators with adaptive length. Note that only estimators with length ≥ 1 are used in V π trusted . Due to Minkowski's inequality the trust region estimator thus shows at least the same contraction as a 1-step bootstrap, but can be faster due to its adaptive nature: Proposition 4. Let G π,µz IS be a set of importance sampling estimators as defined in equation 7. Note that they all have the same fix point V π and contract with at least γ. Then the contraction properties carry over to V π trusted . In particular Under review as a conference paper at ICLR 2020 Proof. See Appendix C.

Section Title: Proposition 5. Let G π,µz
  Proposition 5. Let G π,µz Vtrace be a set of V-trace estimators (see equation 8) with corresponding fixed points V z (see equation 3) to which they contract at a speed of an algorithm and behaviour specific η z . Then V π trusted moves towards V β = E z|µz∈M β,π (st) [V z ] shrinking the distance as follows V π trusted − V β ∞ < Proof. See Appendix C. Note how the choice of β and thus M β,π enables us to discard ill-suited G π,µz Vtrace from the esti- mation of V π trusted . Recall that V-trace fixed points V z are biased. Thus β allows us to selec- tively create the V-trace target V β = E z|µz∈M β,π (st) [V z ] and control its bias and the shrinkage max µz∈M β,π (st) |η z (V (s) − V z (s))| ∞ (see Proposition 5). Similarly it can control cases where we can not use the exact importance sampled estimator. The same approach based on nested expectations can be applied to the expectation of the policy gradient estimate and allows to control the bias and greediness (see Proposition 2) there as well.

Section Title: IMPLEMENTATION DETAILS
  IMPLEMENTATION DETAILS In Proposition 5 we have seen that the quality of the trust region V-trace return estimator depends on β. A suitable choice of β can move the return estimate V β closer to V π and improve the shrinkage by reducing max µz∈M β,π (st) |η z (V (s) − V z (s))| ∞ . Hence, we employ a behaviour relevance function β KL that rejects high bias transitions by estimating the Kulback-Leibler divergence between the target policy π and the implied policyπ µz for a sampled behaviour µ z . Recall from Proposition 1 thatπ µz determines the fixed point of the V-trace estimator for behaviour µ z and thus determines the bias in V z . Note that the behaviour probabilities µ z can be evaluated and saved to the replay when the agent executes the behaviour, similarly the target policy π is represented by the agents neural network. Using both and equation 3,π µ can be computed. For large or infinite action spaces a Monte Carlo estimate of the KL divergence can be computed. It is possible to define separate behaviour relevance functions for the policy and value estimate. For simplicity we reject transitions entirely for all estimates and do not consider rejected transitions for the policy gradient and value gradient updates or auxiliary tasks. As described above we stop the Monte-Carlo bootstraps once they reach undesirable state-behaviour pairs. Note that this censoring procedure is computed from state dependent β(π, µ, s) and ensures that the choice of bootstrapping does not depend on the sampled actions. Note that rejection by an action-based criteria such as small π(a|s)/µ(a|s) would introduce an additional bias which we avoid by choosing β KL .

Section Title: EXPERIMENTS
  EXPERIMENTS We present experiments to support the following claims: • Section 5.2: Uniform experience replay obtains comparable results as prioritized experience replay, while being simpler to implement and tune. • Section 5.3: Using fresh experience before inserting it in experience replay is better than learning purely off-policy from experience replay - in line with Proposition 3. • Section 5.4: Sharing experience without trust region performs poorly as suggested by Proposition 2. Off-Policy Trust-Region V-trace solves this issue. • Section 5.5: Sharing experience can take advantage of parallel exploration and obtains state-of-the-art performance on Atari games, while also saving memory through sharing a single experience replay.

Section Title: EXPERIMENTAL SETUP & METHODOLOGY
  EXPERIMENTAL SETUP & METHODOLOGY We use the V-trace distributed reinforcement learning agent ( Espeholt et al., 2018 ) as our baseline. In our experiments we consider two experimental platforms: Atari and DeepMind Lab. On Atari we consider the common single task training regime, where a different agent is trained, from scratch, on each of the tasks. Following  Xu et al. (2018)  we use a discount of 0.995. Motivated by recent work by  Kaiser et al. (2019) , we use the IMPALA deep network and increased the number of channels 4×. We use 96% replay data per batch. Differently from  Espeholt et al. (2018) , we do not use gradient clipping by norm ( Pascanu et al., 2012 ). Updates are computed on mini-batches of 32 (regular) and 128 (replay) trajectories, each corresponding to 19 steps in the environment. In the context of DeepMind Lab, we consider the multi-task suite DMLab-30 ( Espeholt et al., 2018 ), as the visuals and the dynamics are more consistent across tasks. Furthermore the multi-task regime is particularly suitable for the investigation of strongly off-policy data distributions arising from sharing the replay across agents, as concurrently learning agents can easily be stuck in different policy plateaus, generating substantially different data ( Schaul et al., 2019 ). As in  Espeholt et al. (2018) , in the multi-task setting each agent trains simultaneously on a uniform mixture of all tasks rather than individually on each game. The score of an agent is thus the median across all 30 tasks. Following  Hessel et al. (2019) , we augment our agent with multi-task Pop-Art normalization and PixelControl. We use a PreCo LSTM ( Amos et al., 2018 ) instead of the vanilla one ( Hochreiter & Schmidhuber, 1997 ). Updates are computed on mini-batches of multiple trajectories chosen as above, each corresponding to 79 steps in the environment. In early experiments we found that computing the entropy cost only on the online data provided slightly better results, hence we have done so throughout our experiments. In all our experiments, experience sampled from memory is mixed with online data within each mini- batch - following Proposition 3. Episodes are removed in a first in first out order, so that replay always holds the most recent experience. Unless explicitly stated otherwise we consider hyper-parameter sweeps, some of which share experience via replay. In this setting multiple agents start from-scratch, run concurrently at identical speed, and add their new experience into a common replay buffer. All agents will then draw uniform samples from the replay buffer. On DMLab-30 we consider both regular hyper-parameter sweeps and sweeps with population based training (PBT) ( Jaderberg et al., 2017a ). On DMLab-30 sweeps contain 10 agents with hyper-parameters sampled similar as  Espeholt et al. (2018)  but fixed RMSProp = 0.1. On Atari sweeps contain 9 agents with different constant learning rate and entropy cost combinations {3 · 10 −4 , 6 · 10 −4 , 1.2 · 10 −3 } × {5 · 10 −3 , 1 · 10 −2 , 2 · 10 −2 } (distributed by factors {1/2, 1, 2} around the initial parameters reported in  Espeholt et al. (2018) ). Although our focus is on efficient hyper-parameter sweeps given crude initial parameters, we also present a single-agent LASER experiment using the same tuned schedule as  Espeholt et al. (2018) , a 87.5% replay ratio and a 15M replay. We store the entire episodes in the replay buffer and replay each episode from the beginning, using the most recent network parameters to recompute the LSTM states along the way: this is particularly critical when sharing experience between different agents, which may have arbitrarily different state representations.

Section Title: UNIFORM AND PRIORITIZED EXPERIENCE REPLAY
  UNIFORM AND PRIORITIZED EXPERIENCE REPLAY Prioritized experience replay has the potential to provide more efficient learning compared to uniform experience replay ( Schaul et al., 2015 ;  Horgan et al., 2018 ). However, it also introduces a number of new hyper-parameters and design choices: the most critical are the priority metric, how strongly to bias the sampling distribution, and how to correct for the resulting bias. Uniform replay is instead almost parameter-free, requires little tuning and can be easily shared between multiple agents. Experiments provided in Figure 4 in the appendix showed little benefit of actor critic prioritized replay on DMLab-30. Furthermore priorities are typically computed from the agent specific metrics such as the TD-error, which are ill-defined when replay is shared among multiple agents. Hence we used uniform replay for our further investigations.

Section Title: MIXING ON- AND OFF-POLICY EXPERIENCE AND REPLAY CAPACITY
  MIXING ON- AND OFF-POLICY EXPERIENCE AND REPLAY CAPACITY   Figure 2  (left) shows that performance degrades significantly when online data is not present in the batch. This experimentally validates Propositions 2 and 3 that highlight difficulties of learning purely off-policy. Furthermore  Figure 2  (right) shows that best results are obtained with experience replay Under review as a conference paper at ICLR 2020 of 10M capacity and 87.5% ratio. A ratio of 87.5% = 7/8 corresponds to 7 replay samples for each online sample. We have considered ratios of 1/2, 3/4, and 7/8 and observed stable training for all of them. Observe that among those values, larger ratios are more data-efficient as they take advantage of more replayed experience per training step.

Section Title: SHARED EXPERIENCE REPLAY WITH OFF-POLICY TRUST REGION V-TRACE
  SHARED EXPERIENCE REPLAY WITH OFF-POLICY TRUST REGION V-TRACE In line with proposition 2 we observe in  Figure 3  (left) that hyper-parameter sweeps without trust- region are even surpassed by the baseline without experience replay. State-of-the-art results are obtained in  Figure 3  (right) when experience is shared with trust-region in a PBT sweep. Observe that this indicates parallel exploration benefits and saves memory at the same time: in our sweep of 10 replay agents the difference between 10 × 10M (separate replays) and 10M (shared replay) is 10-fold. This effect would be even more pronounced with larger sweeps. As discussed in section 2.3, the bias in V-trace occurs due to the clipping of importance ratios. A potential solution of reducing the bias would be to increase theρ threshold to clip less aggressively and accept increased variance. Figure 4 in the appendix shows that this is not a solution.

Section Title: EVALUATION ON ATARI
  EVALUATION ON ATARI We apply our proposed agent to Atari which has been a long established suite to evaluate reinforcement algorithms ( Bellemare et al., 2013 ). Since we focus on sample-efficient learning we present our results in comparison to prior work at 200M steps ( Figure 1 ). Shared experience replay obtains even better performance than not shared experience replay. This confirms the efficient use of parallel exploration ( Kretchmar, 2002 ). The fastest prior agent to reach 400% is presented by  Kapturowski et al. (2019)  requiring more than 3,000M steps. LASER with shared replay achieves 423% in 60M per agent. Given 200M steps it achieves 448%. We also present a single (no sweep) LASER agent that achieves 431% in 200M steps.

Section Title: CONCLUSION
  CONCLUSION We have presented LASER - an off-policy actor-critic agent which employs a large and shared experience replay to achieve data-efficiency. By sharing experience between concurrently running experiments in a hyper-parameter sweep it is able to take advantage of parallel exploration. As a result it achieves state-of-the-art data efficiency on 57 Atari games given 200M environment steps. Furthermore it achieves competitive results on both DMLab-30 and Atari under regular, not shared experience replay conditions. To facilitate this algorithm we have proposed two approaches: a) mixing replayed experience and on-policy data and b) a trust region scheme. We have shown theoretically and demonstrated through a series of experiments that they enable learning in strongly off-policy settings, which present a challenge for conventional importance sampling schemes.

```
